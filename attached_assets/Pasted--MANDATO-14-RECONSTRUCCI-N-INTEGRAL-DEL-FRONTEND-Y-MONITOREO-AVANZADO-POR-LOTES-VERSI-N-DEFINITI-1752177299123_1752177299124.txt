 MANDATO 14: RECONSTRUCCIN INTEGRAL DEL FRONTEND Y MONITOREO AVANZADO POR LOTES (VERSIN DEFINITIVA Y AJUSTADA)
FILOSOFA FUNDAMENTAL INQUEBRANTABLE (Pilares de la Excelencia y la Sostenibilidad):
INTEGRIDAD TOTAL (Reconstrucci贸n Impecable): El frontend ser谩 dise帽ado y construido desde cero con una atenci贸n meticulosa a la integridad de su c贸digo, su funcionalidad y su interacci贸n con el backend. Cero tolerancia a la deuda t茅cnica y a los errores de integraci贸n. Cada interacci贸n ser谩 verificada contra el REPORTE_ESPECIFICACION_INTERFAZ_BACKEND_FRONTEND_V2_COMPLETO.md y sus nuevas clarificaciones.

PERFECCIN CONTINUA (Dise帽o Proactivo y Observabilidad de Lotes): Implementaci贸n de las funcionalidades de monitoreo avanzadas desde el d铆a uno, ofreciendo una visibilidad sin precedentes del rendimiento del sistema por lote. La interfaz ser谩 fluida, reactiva y visualmente excelente, capaz de presentar datos individuales y agrupados de forma coherente.

TRANSPARENCIA TOTAL (Documentaci贸n Exhaustiva): Cada paso, cada funci贸n, cada interacci贸n y cada dato del nuevo frontend ser谩 documentado de forma inquebrantable. El REPORTE_ESPECIFICACION_INTERFAZ_BACKEND_FRONTEND_V2_COMPLETO.md (y sus extensiones l贸gicas) es la biblia de la integraci贸n.

OPTIMIZACIN SOSTENIBLE (Recursos M铆nimos, Rendimiento M谩ximo): El nuevo frontend ser谩 concebido bajo principios de eficiencia, utilizando solo los recursos necesarios para lograr la m谩xima reactividad y velocidad, sin comprometer la experiencia del usuario. Se priorizar谩 Vanilla JS/Alpine.js para una huella m铆nima.

OBJETIVO PRINCIPAL DEL MANDATO 14:
Dise帽ar y construir un nuevo frontend para el Sistema OCR Empresarial desde cero, con una especificaci贸n funcional precisa y detallada, una integraci贸n infalible con el backend existente (seg煤n REPORTE_ESPECIFICACION_INTERFAZ_BACKEND_FRONTEND_V2_COMPLETO.md y la clarificaci贸n de "salida grupal"), y un sistema de monitoreo avanzado de recursos por lote con visualizaci贸n gr谩fica en tiempo real que refleje la consolidaci贸n de resultados por batch.

FASE 1: PLANIFICACIN Y DISEO DE LA RECONSTRUCCIN DEL FRONTEND
OBJETIVO DE LA FASE 1:
Elaborar la arquitectura de software del nuevo frontend, definir sus componentes y flujos de usuario con granularidad, y seleccionar las herramientas t茅cnicas que aseguren una "Interface Excellence Soberana" con m铆nima huella de recursos, garantizando la correcta gesti贸n y visualizaci贸n de resultados individuales y agrupados por lote.

SUB-OBJETIVOS Y ESTRATEGIAS (Meticulosidad en el Dise帽o):
Dise帽o de la Arquitectura del Frontend (Lightweight & Modular):

1.1. Estructura de Archivos: Definir una estructura clara y modular para los archivos JavaScript, CSS y HTML que minimice las dependencias y facilite el mantenimiento.

1.2. Patrones de Dise帽o: Emplear patrones de dise帽o JavaScript (ej. m贸dulos, publicaci贸n/suscripci贸n) para asegurar la cohesi贸n y el desacoplamiento.

1.3. Selecci贸n de Tecnolog铆a Frontend (Confirmada): Se utilizar谩 Vanilla JavaScript puro y HTML/CSS (con Bootstrap 5 para el layout y Font Awesome para 铆conos) para la reactividad y la interfaz, integr谩ndose con Jinja2 para el renderizado inicial de la plantilla. Esta elecci贸n garantiza la m谩xima optimizaci贸n y el uso m铆nimo de recursos, aline谩ndose con nuestra filosof铆a.

Especificaci贸n Funcional Detallada del Frontend (Cada Interacci贸n del Usuario):

2.1. Pantalla de Carga y Gesti贸n de Archivos (/, /dashboard):

2.1.1. Entrada de Archivos:

Implementaci贸n de 谩rea de arrastrar/soltar (drag-and-drop) de archivos intuitiva.

Bot贸n expl铆cito "SELECCIONAR ARCHIVOS" (id="fileInput") con funcionalidad click que abre el explorador de archivos.

Soporte para selecci贸n de m煤ltiples archivos (im谩genes JPG/PNG).

2.1.2. Lista de Archivos en Cola:

Una tabla o lista visual (id="fileListDisplay") que muestre cada archivo a帽adido.

Para cada archivo: Nombre, tama帽o, y un indicador de estado visual claro (ej. "Pendiente", "Subiendo...", "Procesando...", "Completado", "Error").

Bot贸n "ELIMINAR" junto a cada archivo para removerlo de la cola antes del procesamiento.

2.1.3. Bot贸n de Procesamiento:

Bot贸n "PROCESAR LOTE" (id="processBatchBtn") visible y claramente distinguible.

Debe estar deshabilitado (disabled) si no hay archivos en la cola.

Debe mostrar un spinner o un estado "Procesando..." una vez activado, hasta que el lote se complete.

2.1.4. Interacci贸n con Backend (seg煤n reporte REPORTE_ESPECIFICACION_INTERFAZ_BACKEND_FRONTEND_V2_COMPLETO.md):

Upload de Archivos: Implementar la llamada POST /api/ocr/process_batch utilizando multipart/form-data, asegurando que el request_id se genere y se haga seguimiento. Cada archivo debe ir en el campo files[].

Manejo de Respuestas de Carga: Procesar las respuestas JSON de process_batch para actualizar el estado visual de cada archivo en la lista.

2.2. Dashboard de Monitoreo de Lotes y Resultados:

2.2.1. Panel de Control General:

Indicador de estado de la cola del backend (GET /api/ocr/queue/status).

Contador de lotes procesados, archivos en cola, etc.

2.2.2. Visualizaci贸n de Resultados Procesados y Agrupaci贸n por Lote (SALIDA GRUPAL UNIFICADA):

Una tabla paginada (id="resultsTable") para mostrar los recibos procesados.

Capacidad de Agrupaci贸n: La tabla debe permitir la visualizaci贸n y agrupaci贸n de resultados por lote, utilizando el request_id (o batch_id) proporcionado por el backend. Esto permitir谩 ver la "salida grupal unificada" de cada lote.

Columnas cr铆ticas (field_names del reporte backend): valor_referencia_operacion, fecha_operacion, monto_total, nombre_banco_emisor, file_id, original_filename, etc.

Badge de Confianza: Para cada entrada, una columna dedicada a confidence_avg.

Visualizaci贸n con colores intuitivos: Verde (alta confianza, ej. > 0.90), Amarillo (confianza media, ej. 0.70-0.90), Rojo (baja confianza, ej. < 0.70).

Clases CSS espec铆ficas (badge-confidence-high, badge-confidence-medium, badge-confidence-low).

Bot贸n "VER DETALLE" (id="viewDetailsBtn") para cada fila, que cargue la previsualizaci贸n detallada.

Interacci贸n con Backend: Utilizar GET /api/extract_results para obtener la lista consolidada.

REQUERIMIENTO EXPLCITO AL BACKEND: Para permitir la agrupaci贸n por lote, el endpoint GET /api/extract_results DEBE incluir el request_id (o batch_id) asociado a cada archivo procesado en su respuesta JSON. Si el REPORTE_ESPECIFICACION_INTERFAZ_BACKEND_FRONTEND_V2_COMPLETO.md no lo especifica actualmente en esa respuesta, se asume como una extensi贸n l贸gica requerida para la funcionalidad de "salida grupal".

2.3. Previsualizaci贸n Detallada de Recibo (id="fileDetailsModal"):

2.3.1. Carga de Imagen: Mostrar la imagen original del recibo.

2.3.2. Visualizaci贸n de Campos Extra铆dos:

Lista clara de los field_names y sus valor_extraido.

Visualizaci贸n Espacial (si factible): Si la tecnolog铆a lo permite y el backend proporciona coordenadas, intentar superponer las cajas de texto extra铆das con sus valores y confianzas sobre la imagen del recibo.

Campo confidence_avg: Mostrarlo prominentemente para el recibo individual.

2.3.3. Funcionalidad de Copia: Bot贸n "COPIAR NOMBRE DE ARCHIVO" (id="copyFilenamePreviewBtn") y botones individuales para copiar valores extra铆dos espec铆ficos al portapapeles.

2.3.4. Interacci贸n con Backend: Utilizar GET /api/ocr/result_data/<filename> para obtener los datos espec铆ficos de un archivo.

Implementaci贸n del Monitoreo Avanzado de Recursos por Lote (PULSO DE INFORMACIN - Nivel de Detalle por Lote):

3.1. Recopilaci贸n de M茅tricas por Lote (Backend - Requiere Ajuste/Confirmaci贸n):

ACCIN IA: Asumir que el backend, tras el procesamiento de cada lote, enviar谩 un evento o publicar谩 m茅tricas a un endpoint espec铆fico (GET /api/metrics/batch o similar).

MTRICAS ESENCIALES POR LOTE (JSON):

batch_id: Identificador 煤nico del lote.

timestamp_processed: Marca de tiempo de finalizaci贸n del lote.

num_images_processed: Cantidad de im谩genes en el lote.

cpu_usage_avg_percent: Uso promedio de CPU (0-100%).

memory_usage_avg_mb: Uso promedio de memoria (MB).

gpu_usage_avg_percent: Uso promedio de GPU (0-100%, si la infraestructura lo soporta y se habilita).

batch_processing_time_sec: Tiempo total de procesamiento del lote (segundos).

num_errors_in_batch: Errores reportados en el lote.

3.2. Visualizaci贸n de "Pulso de Informaci贸n" (Gr谩ficos Din谩micos):

ACCIN IA: Crear un 谩rea en el dashboard dedicada a los gr谩ficos de monitoreo.

Componente Gr谩fico (ej. Chart.js o similar, como opci贸n ligera): Un gr谩fico que muestre m煤ltiples series de datos (cpu_usage, memory_usage, gpu_usage, batch_processing_time).

Eje X: Representar谩 los batch_id (o un contador secuencial de lotes) para mostrar el "pulso" por lote.

Eje Y: Representar谩 los valores de las m茅tricas.

Interactividad: Al pasar el cursor sobre un punto del gr谩fico, se deben mostrar los detalles exactos del lote (todas las m茅tricas).

Actualizaci贸n en Tiempo Real: El gr谩fico y las m茅tricas se actualizar谩n din谩micamente a medida que el backend finalice el procesamiento de cada nuevo lote.

3.3. Log Detallado del Proceso por Lote:

Un panel de texto en el frontend (id="batchLog") que registre eventos significativos de cada lote: "Lote X iniciado", "Lote X completado en Y segundos", "Uso CPU: Z%", "Errores en lote X: N".

FASE 2: CONSTRUCCIN Y VALIDACIN DEL NUEVO FRONTEND
OBJETIVO DE LA FASE 2:
Implementar el frontend seg煤n el dise帽o y las especificaciones de la Fase 1, realizando pruebas exhaustivas para garantizar su funcionalidad, estabilidad y el cumplimiento de los principios de Integridad Total y Optimizaci贸n Sostenible, asegurando la correcta representaci贸n de la "salida grupal" y el monitoreo por lotes.

SUB-OBJETIVOS Y ESTRATEGIAS (Ejecuci贸n Impecable):
Desarrollo del Frontend (Codificaci贸n de Calidad Suprema):

1.1. HTML/Jinja2: Reconstrucci贸n de templates/interface_excellence_dashboard.html siguiendo la nueva estructura y los componentes definidos. Inclusi贸n de los enlaces a los nuevos archivos JS/CSS.

1.2. CSS: Implementaci贸n de los estilos visuales para la "Interface Excellence Soberana", incluyendo los badges de confianza y el layout adaptativo (responsive design).

1.3. JavaScript: Codificaci贸n modular de las funcionalidades del frontend, incluyendo la gesti贸n de archivos, interacci贸n con la API, actualizaci贸n de la UI, y la l贸gica de los gr谩ficos de monitoreo.

Se crear谩n archivos JS separados y optimizados (ej. file-manager.js, api-client.js, results-viewer.js, monitoring-dashboard.js, main.js).

Cada archivo JS ser谩 auto-contenido y responsable de su dominio.

Integraci贸n con el Backend (Conectividad Perfecta y Data Unificada):

2.1. Implementaci贸n de llamadas API: Codificar las llamadas fetch o XMLHttpRequest a los endpoints del backend (/api/ocr/process_batch, /api/extract_results, etc.) siguiendo rigurosamente los "Contratos de Petici贸n y Respuesta" definidos en el REPORTE_ESPECIFICACION_INTERFAZ_BACKEND_FRONTEND_V2_COMPLETO.md y la nueva necesidad del request_id en extract_results para la "salida grupal".

2.2. Manejo de Errores y Estados: Implementar l贸gica robusta para manejar respuestas de error del backend (4xx, 5xx), mostrando mensajes de usuario claros y 煤tiles, y gestionando los estados de carga y procesamiento.

Pruebas Exhaustivas y Validaci贸n (Cero Errores Conocidos):

3.1. Pruebas Funcionales:

Carga de archivos individuales y por lotes (con y sin metadatos de WhatsApp).

Procesamiento exitoso y fallido de lotes.

Visualizaci贸n correcta de resultados en el dashboard y en la previsualizaci贸n detallada.

Verificaci贸n de Agrupaci贸n por Lotes: Confirmar que la "salida grupal" se muestra y se puede navegar correctamente en el dashboard.

Correcta aplicaci贸n de los "badges de confianza" y sus colores.

Funcionalidad de copia al portapapeles.

3.2. Pruebas de Monitoreo:

Verificar que el "Pulso de Informaci贸n" (gr谩ficos y log) se actualiza correctamente con cada lote procesado.

Validar que las m茅tricas (CPU, Memoria, GPU, etc.) se muestran de forma precisa y coherente con la actividad del backend.

3.3. Pruebas de Compatibilidad:

Verificar la funcionalidad en los navegadores web principales (Chrome, Firefox, Edge).

Asegurar la adaptabilidad (responsive design) en diferentes tama帽os de pantalla.

RESULTADOS ESPERADOS DEL MANDATO 14:
templates/interface_excellence_dashboard.html: El nuevo y optimizado archivo de plantilla HTML.

static/js/ (Nuevos Archivos JS):

main.js: L贸gica de inicializaci贸n y coordinaci贸n.

file-manager.js: L贸gica para la carga y gesti贸n de archivos.

api-client.js: Cliente robusto para todas las interacciones con el backend API.

results-viewer.js: L贸gica para mostrar y filtrar los resultados, incluyendo la gesti贸n de la agrupaci贸n por lote.

monitoring-dashboard.js: L贸gica para los gr谩ficos y el log de monitoreo de rendimiento por lote.

(Posibles otros JS para utilidades o componentes espec铆ficos).

static/css/ (Nuevos Archivos CSS):

style.css (o similar): Estilos personalizados para la "Interface Excellence Soberana".

REPORTE_FINAL_FRONTEND_V2.md: Un informe detallado que documente el proceso de reconstrucci贸n, la estructura del c贸digo, los resultados de las pruebas, y la confirmaci贸n de la implementaci贸n de todas las funcionalidades, incluyendo el monitoreo avanzado y la correcta representaci贸n de la "salida grupal" unificada.

